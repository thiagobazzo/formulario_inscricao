<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Inscri√ß√£o - Torneio de Basquete</title>
  <style>
    body{font-family:Arial,Helvetica,sans-serif;background:#f6f6f6;margin:0;padding:0}
    .wrap{max-width:720px;margin:30px auto;background:#fff;border-radius:12px;padding:22px;box-shadow:0 8px 24px rgba(0,0,0,.08)}
    h1{margin:0 0 8px}
    p{margin:0 0 18px;color:#444}
    label{display:block;margin:12px 0 6px;font-weight:600}
    input{width:100%;padding:12px;border:1px solid #ddd;border-radius:10px;font-size:15px}
    .row{display:flex;gap:12px}
    .row>div{flex:1}
    .hidden{display:none}
    button{margin-top:16px;width:100%;padding:12px;border:0;border-radius:10px;font-size:16px;font-weight:700;cursor:pointer;background:#111;color:#fff}
    .msg{margin-top:14px;padding:12px;border-radius:10px;display:none}
    .ok{background:#eaffea;border:1px solid #bfe8bf;color:#125c12}
    .err{background:#ffecec;border:1px solid #f1b6b6;color:#7a1111}
    .hint{font-size:12px;color:#666;margin-top:6px}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>üèÄ Inscri√ß√£o - Torneio de Basquete</h1>
    <p>Preencha os dados abaixo para se inscrever.</p>

    <!-- ‚úÖ ID do formul√°rio precisa ser "form" -->
    <form id="form">

      <label for="nome_completo">Nome completo *</label>
      <input id="nome_completo" name="nome_completo" required placeholder="Ex: Jo√£o da Silva" />

      <div class="row">
        <div>
          <label for="idade">Idade *</label>
          <input id="idade" name="idade" type="number" min="5" max="100" required placeholder="Ex: 18" />
        </div>
        <div>
          <label for="telefone">Telefone *</label>
          <input id="telefone" name="telefone" required placeholder="(11) 91234-5678" />
          <div class="hint">Aceita: (NN) NNNN-NNNN ou (NN) NNNNN-NNNN</div>
        </div>
      </div>

      <label for="rg">RG *</label>
      <input id="rg" name="rg" required placeholder="12.345.678-9" />
      <div class="hint">Formato: NN.NNN.NNN-N</div>

      <!-- ‚úÖ bloco que aparece para menor -->
      <div id="box_responsavel" class="hidden">
        <h3 style="margin:18px 0 6px;">Respons√°vel (menor de idade)</h3>

        <label for="nome_responsavel">Nome do respons√°vel *</label>
        <input id="nome_responsavel" name="nome_responsavel" placeholder="Ex: Maria da Silva" />

        <label for="rg_responsavel">RG do respons√°vel *</label>
        <input id="rg_responsavel" name="rg_responsavel" placeholder="12.345.678-9" />
      </div>

      <button type="submit">Enviar inscri√ß√£o</button>

      <div id="msg_ok" class="msg ok"></div>
      <div id="msg_err" class="msg err"></div>
    </form>
  </div>

<script>
function onlyDigits(v){ return (v||"").toString().replace(/\D/g,''); }

function maskTelefone(v){
  const d = onlyDigits(v).slice(0,11);

  if (d.length <= 2) return d;
  if (d.length <= 6) return `(${d.slice(0,2)}) ${d.slice(2)}`;

  // 10 d√≠gitos: (NN) NNNN-NNNN
  if (d.length <= 10) return `(${d.slice(0,2)}) ${d.slice(2,6)}-${d.slice(6)}`;

  // 11 d√≠gitos: (NN) NNNNN-NNNN
  return `(${d.slice(0,2)}) ${d.slice(2,7)}-${d.slice(7)}`;
}

function maskRG(v){
  const d = onlyDigits(v).slice(0,9); // NN.NNN.NNN-N
  if (d.length <= 2) return d;
  if (d.length <= 5) return `${d.slice(0,2)}.${d.slice(2)}`;
  if (d.length <= 8) return `${d.slice(0,2)}.${d.slice(2,5)}.${d.slice(5)}`;
  return `${d.slice(0,2)}.${d.slice(2,5)}.${d.slice(5,8)}-${d.slice(8)}`;
}

function showMsg(id, text){
  const el = document.getElementById(id);
  if (!el) return;
  el.style.display = "block";
  el.textContent = text;
}
function hideMsg(id){
  const el = document.getElementById(id);
  if (!el) return;
  el.style.display = "none";
  el.textContent = "";
}

document.addEventListener("DOMContentLoaded", () => {
  const form = document.getElementById("form");
  const inpNome = document.getElementById("nome_completo");
  const inpIdade = document.getElementById("idade");
  const inpTel  = document.getElementById("telefone");
  const inpRG   = document.getElementById("rg");

  const boxResp = document.getElementById("box_responsavel");
  const inpNomeResp = document.getElementById("nome_responsavel");
  const inpRGResp   = document.getElementById("rg_responsavel");

  inpTel.addEventListener("input", e => e.target.value = maskTelefone(e.target.value));
  inpRG.addEventListener("input",  e => e.target.value = maskRG(e.target.value));
  inpRGResp.addEventListener("input", e => e.target.value = maskRG(e.target.value));

  inpIdade.addEventListener("input", () => {
    const v = parseInt(inpIdade.value || "0", 10);
    if (!isNaN(v) && v < 18) boxResp.classList.remove("hidden");
    else boxResp.classList.add("hidden");
  });

  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    hideMsg("msg_ok");
    hideMsg("msg_err");

    const idadeVal = parseInt(inpIdade.value || "0", 10);
    const ehMenor = !isNaN(idadeVal) && idadeVal < 18;

    const payload = {
      nome_completo: inpNome.value,
      idade: inpIdade.value,
      telefone: inpTel.value,
      rg: inpRG.value,
      nome_responsavel: ehMenor ? inpNomeResp.value : null,
      rg_responsavel: ehMenor ? inpRGResp.value : null
    };

    try {
      const r = await fetch("/api/inscrever", {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify(payload)
      });

      const data = await r.json().catch(()=>({}));

      if (!r.ok) {
        showMsg("msg_err", data.erro || "Erro ao enviar inscri√ß√£o.");
        return;
      }

      showMsg("msg_ok", "Inscri√ß√£o realizada! Baixando comprovante...");

      if (data.comprovante_url) {
        window.location.href = data.comprovante_url;
      }
    } catch (err) {
      showMsg("msg_err", "Falha de conex√£o. Tente novamente.");
      console.error(err);
    }
  });
});
</script>
</body>
</html>

